<!doctype html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="content-language" content="en" />

    <style type="text/css">
        .container {
            position: fixed;
        }

        .container div {
            position: absolute;
        }

        .container .tri {
            font-size: 80%;
            color: darkgreen;
        }
    </style>
</head>

<body>
    <div id="content"></div>
    <script type="text/javascript">

        // pairs are n and 11-n
        //
        //  0     1     2
        //     3     4
        //  5           6
        //     9    11
        //  7    10     8
        // 

        let triangles = '0-1-2 1-3-4 3-5-9 4-11-6 2-6-8 0-5-7 9-10-11 7-8-10'.split(' ').map(t => t.split('-'));
        let quads = '0-2-8-7 0-1-3-5 1-2-6-4 6-8-10-11 5-9-10-7 3-4-11-9'.split(' ').map(t => t.split('-'));

        let next = getPermInter(6);
        let bestScore = Infinity;

        let nui = 0;
        let uiCurrent = makeUI();
        let uiBest = makeUI();


        loop();

        function loop() {

            let ok = frame();

            if (ok) setTimeout(loop, 20)
        }

        function frame() {

            let perm = next();

            if (perm === undefined) return false;

            let figures = expand(perm);

            let score = appraise(figures);
            render(figures, score, uiCurrent);
            if (score < bestScore) {
                render(figures, score, uiBest)
                bestScore = score;
            }

            return false;
        }

        function getFaceValue(initials, n) {
            return n < 6
                ? initials[n]
                : 11 - initials[11 - n];
        }

        function expand(initials) {
            let expanded = [...initials];

            for (let tr of triangles) {
                expanded.push(
                    tr.reduce((sum, n) => sum + getFaceValue(initials, n) + 1, 0)
                );
            }

            for (let qu of quads) {
                expanded.push(
                    qu.reduce((sum, n) => sum + getFaceValue(initials, n) + 1, 0)
                );
            }

            return expanded;
        }

        function render(figures, score, ui) {
            console.log(figures, score);

            for (let i = 0; i < figures.length; ++i) {
                ui[i].innerText = 1 + figures[i];
                if (i < 5)
                    ui[i + figures.length + 1].innerText = 12 - figures[i];
            }

            ui[figures.length].innerText = score;
        }

        function makeUI() {
            const s = 5;
            let divs = [];

            let container = document.createElement('div');
            container.className = 'container';
            container.style.height = container.style.width = (s * 4) + 'rem';
            container.style.left = (s * 6 * nui++) + 'rem';

            let points = [[1, 1], [3, 1], [5, 1], [2, 2], [4, 2], [1, 3]];
            let tris = [[3, 0.5], [3, 1.5], [1.5, 3], [4.5, 3], [5.5, 3], [0.5, 3], [3, 4.5], [3, 5.5]];
            let qs = []

            for (let i = 0; i < 6; ++i) {
                let div = document.createElement('div');

                div.style.left = 3 * points[i][0] + 'rem'
                div.style.top = 3 * points[i][1] + 'rem'

                divs.push(div);
                container.appendChild(div);
            }

            let n = 0;
            for (let _ of triangles) {
                let div = document.createElement('div');
                div.className = 'tri'
                div.style.left = 3 * tris[n][0] + 'rem'
                div.style.top = 3 * tris[n++][1] + 'rem'
                divs.push(div);
                container.appendChild(div);
            }

            n = 0;
            for (let _ of quads) {
                let div = document.createElement('div');
                // div.style.left = 3 * qs[n][0] + 'rem'
                // div.style.top = 3 * qs[n++][1] + 'rem'
                divs.push(div);
                container.appendChild(div);
            }

            for (let i = 0; i < 6; ++i) {
                let div = document.createElement('div');

                div.style.left = 3 * (6 - points[i][0]) + 'rem';
                div.style.top = 3 * (6 - points[i][1]) + 'rem';

                divs.push(div);
                container.appendChild(div);
            }

            let div = document.createElement('div');

            div.style.left = 3 * 3 + 'rem'
            div.style.top = 3 * 7 + 'rem'

            divs.push(div);
            container.appendChild(div);

            document.body.appendChild(container);
            return divs;
        }

        function appraise(figures) {
            let score = 0;
            for (let i = 6; i < figures.length; ++i)
                score += figures[i];
            return score;
        }

        // Steinhaus–Johnson–Trotter
        function getPermInter(n) {
            const up = true;
            const down = false;

            let values = [];
            let directions = [];
            let first = true;

            for (let i = 0; i < n; ++i) {
                values.push(i);
                directions.push(down);
            }

            function getTarget(i) {
                return i + (directions[i] == up ? 1 : -1);
            }

            function validMove(i) {
                let target = getTarget(i);
                return target >= 0 && target < n ? values[target] < values[i] : false
            }

            return () => {
                if (first) {
                    first = false;
                    return [...values];
                }

                let largestMobileId = values.reduce((best, _, current) => best < 0 || values[best] < values[current] ? validMove(current) ? current : best : best, -1);

                if (largestMobileId == -1) return undefined;

                let target = getTarget(largestMobileId);

                for (let i = 0; i < n; ++i) {
                    if (values[i] > values[largestMobileId]) directions[i] = !directions[i];
                }

                [values[largestMobileId], values[target]] = [values[target], values[largestMobileId]];
                [directions[largestMobileId], directions[target]] = [directions[target], directions[largestMobileId]];

                return [...values];
            }
        }
    </script>
</body>

</html>