(()=>{"use strict";var t={173:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fullscreenCanvas=e.fullscreenCanvas3d=e.getCanvas=void 0,e.getCanvas=(t=!1)=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,t||(e.style.position="absolute",e.style.top="0",e.style.left="0"),e},e.fullscreenCanvas3d=(t=!1)=>{const s=(0,e.getCanvas)(t),n=s.getContext("webgl");if(null==n)throw new Error("failed to get 'webgl' context");return document.body.appendChild(s),n},e.fullscreenCanvas=function(t=!1,n=!1){const i=(0,e.getCanvas)(t),r=i.getContext("2d",{alpha:!n});if(null==r)throw new Error("failed to get '2d' context");return r.clear=function(){return r.clearRect(0,0,r.canvas.width,r.canvas.height),r},r.makePath=function(t){r.beginPath(),r.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)r.lineTo(t[e],t[e+1]);return r.closePath(),r},r.strokeCircle=function(t,e,s){return r.beginPath(),r.arc(t,e,s,0,2*Math.PI,!0),r.closePath(),r.stroke(),r},r.fillCircle=function(t,e,s){return r.beginPath(),r.arc(t,e,s,0,2*Math.PI,!0),r.closePath(),r.fill(),r},r.fillHex=function(t,e,n){r.beginPath(),r.save(),r.translate(t,e),r.moveTo(n/s,0);for(let t=0;t<5;++t)r.rotate(Math.PI/3),r.lineTo(n/s,0);return r.restore(),r.closePath(),r.fill(),r},document.body.style.overflow="hidden",document.body.appendChild(i),r};const s=Math.sqrt(3)/2},711:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Loop=void 0,e.Loop=class{constructor(t,e,s,n){this.fixedDelta=t,this.init=e,this.fixed=s,this.variable=n,this.isRunning=!1,this.fixedAccum=0}start(){if(this.isRunning)return;let t=this.init();this.isRunning=!0;let e=0;const s=n=>{const i=0==e,r=i?0:n-e;e=n,t=this.update(r,t,i),this.isRunning&&requestAnimationFrame(s)};requestAnimationFrame(s)}stop(){this.isRunning=!1}update(t,e,s=!1){let n=e;this.fixedAccum+=t;let i=!1;if(s)n=this.fixed(this.fixedDelta,n),i=!0;else for(;this.fixedAccum>this.fixedDelta;)this.fixedAccum-=this.fixedDelta,n=this.fixed(this.fixedDelta,n),i=!0;return i&&this.variable(t,n),n}}},405:(t,e)=>{function s(t,e){return"number"==typeof e&&"number"==typeof t?Math.floor(t+Math.random()*(e-t)):"number"==typeof t?Math.floor(t*Math.random()):t instanceof Array?t[Math.floor(t.length*Math.random())]:Math.random()}Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=e.array=e.rnd=void 0,e.rnd=s,e.array=function(t,e,s){const n=[];for(let i=0;i<e;++i){const e=[];for(let n=0;n<t;++n)e.push(s(i,n));n.push(e)}return n},e.shuffle=function(t){for(let e=t.length-1;e>0;--e){const n=s(e+1);[t[e],t[n]]=[t[n],t[e]]}}},582:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.newVector=e.Vector=e.AABB=void 0,e.AABB=class{constructor(t,e,s,n){this.x=t,this.y=e,this.w=s,this.h=n}contains(t){const{x:e,y:s,w:n,h:i}=this;return t.x>=e&&t.y>=s&&t.x<e+n&&t.y<s+i}intersects(t){const{x:e,y:s,w:n,h:i}=this;return!(e+n<t.x||s+i<t.y||t.x+t.w<e||t.y+t.h<s)}};class s{constructor(t,e){this.x=t,this.y=e}get mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return new s(this.x+t.x,this.y+t.y)}times(t){return new s(t*this.x,t*this.y)}distance(t){const e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)}rotate(t){const e=Math.cos(t),n=Math.sin(t),{x:i,y:r}=this;return new s(i*e+r*-n,i*n+r*e)}}e.Vector=s,e.newVector=(t,e)=>new s(Math.cos(t)*e,Math.sin(t)*e)},697:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const n=s(173);e.Renderer=class{constructor(){this.ctx=(0,n.fullscreenCanvas)(!1,!0)}draw(t,e,s,n,i,r){const{ctx:o,width:a,height:h}=this;o.save(),o.clearRect(0,0,a,h);const l=.5+(0|Math.min(h/50,a/50)),c=a-2*l,d=h-2*l;o.scale(c/i.w,-d/i.h),o.translate(l-i.x,-l-i.y-i.h),o.beginPath(),o.rect(i.x,i.y,i.w,i.h),o.clip(),o.strokeStyle="#630";let f=i.w/24|0,u=i.h/24|0;for(let t=0;t<12;++t)o.strokeRect(i.x+f*t*2,i.y,f,i.h),o.strokeRect(i.x,i.y+u*t*2,i.w,u);o.fillStyle="gold",o.strokeStyle="gold";for(let e of t)o.fillCircle(e.x,e.y,10*(1+.2*Math.sin(1*r.frame/10))),o.strokeCircle(e.x,e.y,50*(1+.2*Math.sin(1*r.frame/9)));o.strokeStyle="white",o.lineWidth=8;for(let t of s)if(!t.isDead){if(t.mainOn){o.strokeStyle="white",o.lineWidth=8;const e=t.thrustVector.times(300);o.beginPath(),o.moveTo(t.pos.x,t.pos.y),o.lineTo(t.pos.x-e.x,t.pos.y-e.y),o.stroke()}if(t.leftOn&&!t.rightOn){o.strokeStyle="red",o.lineWidth=5;const e=t.leftThrust.times(2e3);o.beginPath(),o.moveTo(t.pos.x,t.pos.y),o.lineTo(t.pos.x+e.x,t.pos.y+e.y),o.stroke()}if(t.rightOn&&!t.leftOn){o.strokeStyle="green",o.lineWidth=5;const e=t.rightThrust.times(2e3);o.beginPath(),o.moveTo(t.pos.x,t.pos.y),o.lineTo(t.pos.x+e.x,t.pos.y+e.y),o.stroke()}}o.fillStyle="#E23636";for(let t of s)t.isDead||(o.save(),o.translate(t.pos.x,t.pos.y),o.rotate(Math.atan2(t.heading.y,t.heading.x)-Math.PI/2),o.scale(2,2),o.beginPath(),o.moveTo(0,10),o.lineTo(10/3,0),o.lineTo(-10/3,0),o.closePath(),o.fill(),o.restore());o.fillStyle="white";for(let t of n)o.fillCircle(t.pos.x,t.pos.y,50*(m=t.age/t.lifespan,1-Math.pow(1-m,5)));var m;o.lineWidth=2,o.fillStyle="#000",o.strokeStyle="#fc0",o.strokeRect(i.x,i.y,i.w,i.h);for(let t of e)o.fillRect(t.x,t.y,t.w,t.h),o.strokeRect(t.x,t.y,t.w,t.h);o.translate(i.x+10,i.h-10),o.scale(1,-1);let g=0;for(let t=0;t<12;++t){let e=s[(t+(r.frame/10|0))%s.length],n=0;for(let t of e.commands)o.fillStyle=`hsl(${120*t.thruster/Math.PI}, 100%, 80%)`,o.fillRect(n/80,3*g,5,2),n+=t.outTime;if(++g>12)break}g+=45,this.ctx.fillStyle="grey",this.ctx.fillText(r.first+"s",0,g),this.ctx.fillText(r.globalBest.toFixed(2)+"pts % "+(1/r.rate/1e3).toFixed(3)+"s/pt",0,g+20),this.ctx.fillText(r.best.toFixed(2)+"pts",0,g+40),this.ctx.restore()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}}},526:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Explosion=e.Command=e.Rocket=void 0;const n=s(405),i=s(582);e.Rocket=class{get thrustVector(){return this.heading.times(this.thrust/this.heading.mag)}get leftThrust(){const t=new i.Vector(this.heading.y,-this.heading.x);return t.times(this.steer/t.mag)}get rightThrust(){const t=new i.Vector(-this.heading.y,this.heading.x);return t.times(this.steer/t.mag)}constructor(t,e,s,n){this.gravity=s,this.commands=n,this.commandIndex=0,this.timer=0,this.mainOn=!0,this.leftOn=!1,this.rightOn=!1,this.thrust=.03,this.steer=.01,this.heading=(0,i.newVector)(Math.PI/2,1),this.vector=new i.Vector(0,0),this.bestScore=0,this.isDead=!1,this.pos=new i.Vector(t,e)}score(t){this.bestScore=Math.max(this.bestScore,t)}advance(t){let e=t,s=new i.Vector(0,0);for(;e>0;){let t=this.commands[this.commandIndex];if(this.timer>0){const t=Math.min(this.timer,e);this.timer-=t,e-=t,this.mainOn&&(s=s.add(this.thrustVector.times(t))),this.leftOn&&!this.rightOn&&(this.heading=this.heading.rotate(-this.steer*t)),this.rightOn&&!this.leftOn&&(this.heading=this.heading.rotate(this.steer*t))}if(e>0){switch(t.thruster){case 0:this.mainOn=!this.mainOn;break;case 1:this.leftOn=!this.leftOn;break;case 2:this.rightOn=!this.rightOn}this.timer+=t.outTime,this.commandIndex=++this.commandIndex%this.commands.length}}this.vector=this.vector.add(s).add(this.gravity.times(t)),this.pos=this.pos.add(this.vector)}},e.Command=class{constructor(t,e){this.thruster=t,this.outTime=e}},e.Explosion=class{constructor(t){this.pos=t,this.age=0,this.lifespan=(0,n.rnd)(100,300)}advance(t){this.age+=t}get isAlive(){return this.age<this.lifespan}}},746:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.deg=e.tau=e.array=void 0,e.array=(t,e)=>{const s=new Array(t);for(let n=0;n<t;++n)s[n]=e(n);return s},e.tau=2*Math.PI,e.deg=Math.PI/180}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,s),r.exports}(()=>{const t=s(711),e=s(697),n=s(405),i=s(582),r=s(746),o=s(526),a=400,h=500;let l=0;function c(t){return new o.Rocket(0,100,new i.Vector(0,-.015),t)}function d(t,e){(0,n.rnd)()<.5&&([t,e]=[e,t]);let s=(0,n.rnd)(t.length),i=(0,n.rnd)(t.length),r=(0,n.rnd)(e.length),a=(0,n.rnd)(e.length);s>i&&([s,i]=[i,s]),r>a&&([r,a]=[a,r]);const h=t.slice(0,s).concat(e.slice(r,a)).concat(t.slice(i));if((0,n.rnd)()<.4){const t=(0,n.rnd)(["flip","drop","spawn","resize"]),e=(0,n.rnd)(h.length);switch(t){case"flip":h[e]=f();break;case"drop":h.splice(e,1);break;case"spawn":h.splice(e,0,f());break;case"resize":h[e]=new o.Command(h[e].thruster,h[e].outTime*(0,n.rnd)(900,1100)/1e3)}}return h}function f(){const t=(0,n.rnd)([0,1,2]);return new o.Command(t,(0,n.rnd)(a/(0==t?1:3)))}new t.Loop(1e3/60,(function(){const t=new e.Renderer,{width:s,height:o}=t,a=new i.AABB(-s/2,0,s,o),l=(0,r.array)(h,(t=>c((0,r.array)((0,n.rnd)(10,30),f)))),d=[new i.AABB(-s/4,.4*o,s/5,o/20),new i.AABB(s/20,.4*o,s/5,o/20),new i.AABB(-s/2,.7*o,s/4,o/20),new i.AABB(s/4,.7*o,s/4,o/20)];return{renderer:t,rockets:l,area:a,explosions:[],goals:[new i.Vector(-s/3,.9*o),new i.Vector(s/3,.9*o)],obstacles:d,wins:0,first:0,best:0,bestCommands:0,avgCommands:0,avgCommandsCount:0,globalBest:0,lastGlobalImp:0,rate:0,frame:0,gen:0}}),(function(t,e){e.explosions=e.explosions.filter((e=>(e.advance(t),e.isAlive))),++e.frame;let s=0,i=0;for(let n of e.rockets){if(n.isDead)continue;n.advance(t);const r=e.goals.reduce(((t,e)=>Math.min(t,e.distance(n.pos))),1/0),a=r<50,h=(250/r+l/1e3/10)/(a?1:20);n.score(h),a&&(e.wins++,0==e.first&&(e.first=l/1e3)),e.best=Math.max(e.best,n.bestScore),e.globalBest<n.bestScore&&(e.globalBest>0&&(e.rate=(n.bestScore-e.globalBest)/(performance.now()-e.globalBest)),e.lastGlobalImp=performance.now(),e.globalBest=n.bestScore),e.best==n.bestScore&&(e.bestCommands=n.commands.length),a||!e.area.contains(n.pos)||e.obstacles.some((t=>t.contains(n.pos)))?(e.explosions.every((t=>t.pos.distance(n.pos)>30||t.age/t.lifespan>.2))&&e.explosions.push(new o.Explosion(n.pos)),n.isDead=!0):(i+=n.commands.length,++s)}if(s>0&&(e.avgCommands+=i,e.avgCommandsCount+=s),(l+=t)>1e4||0==s){l=0,++e.gen,e.best=e.wins=e.first=e.bestCommands=0;const t=e.rockets;for(t.sort(((t,e)=>e.bestScore-t.bestScore)),e.rockets=[];e.rockets.length<h;){let s=t[(0,n.rnd)()*(0,n.rnd)()*h|0],i=t[(0,n.rnd)()*(0,n.rnd)()*h|0];if(s==i)continue;const r=d(s.commands,i.commands);r.length>=10&&r.length<30&&e.rockets.push(c(r))}}return e}),(function(t,e){e.renderer.draw(e.goals,e.obstacles,e.rockets,e.explosions,e.area,e)})).start()})()})();