(()=>{"use strict";var e={996:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fullscreenCanvas=t.fullscreenCanvas3d=t.getCanvas=void 0,t.getCanvas=(e=!1)=>{const t=document.createElement("canvas");return t.width=window.innerWidth,t.height=window.innerHeight,e||(t.style.position="absolute",t.style.top="0",t.style.left="0"),t},t.fullscreenCanvas3d=(e=!1)=>{const s=(0,t.getCanvas)(e),n=s.getContext("webgl");if(null==n)throw new Error("failed to get 'webgl' context");return document.body.appendChild(s),n},t.fullscreenCanvas=function(e=!1,n=!1){const r=(0,t.getCanvas)(e),o=r.getContext("2d",{alpha:!n});if(null==o)throw new Error("failed to get '2d' context");return o.clear=function(){return o.clearRect(0,0,o.canvas.width,o.canvas.height),o},o.makePath=function(e){o.beginPath(),o.moveTo(e[0],e[1]);for(var t=2;t<e.length;t+=2)o.lineTo(e[t],e[t+1]);return o.closePath(),o},o.strokeCircle=function(e,t,s){return o.beginPath(),o.arc(e,t,s,0,2*Math.PI,!0),o.closePath(),o.stroke(),o},o.fillCircle=function(e,t,s){return o.beginPath(),o.arc(e,t,s,0,2*Math.PI,!0),o.closePath(),o.fill(),o},o.fillHex=function(e,t,n){o.beginPath(),o.save(),o.translate(e,t),o.moveTo(n/s,0);for(let e=0;e<5;++e)o.rotate(Math.PI/3),o.lineTo(n/s,0);return o.restore(),o.closePath(),o.fill(),o},document.body.style.overflow="hidden",document.body.appendChild(r),o};const s=Math.sqrt(3)/2},424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Loop=void 0,t.Loop=class{constructor(e,t,s,n){this.fixedDelta=e,this.init=t,this.fixed=s,this.variable=n,this.isRunning=!1,this.fixedAccum=0}start(){if(this.isRunning)return;let e=this.init();this.isRunning=!0;let t=0;const s=n=>{const r=0==t,o=r?0:n-t;t=n,e=this.update(o,e,r),this.isRunning&&requestAnimationFrame(s)};requestAnimationFrame(s)}stop(){this.isRunning=!1}update(e,t,s=!1){let n=t;this.fixedAccum+=e;let r=!1;if(s)n=this.fixed(this.fixedDelta,n),r=!0;else for(;this.fixedAccum>this.fixedDelta;)this.fixedAccum-=this.fixedDelta,n=this.fixed(this.fixedDelta,n),r=!0;return r&&this.variable(e,n),n}}},663:(e,t)=>{function s(e,t){return"number"==typeof t&&"number"==typeof e?Math.floor(e+Math.random()*(t-e)):"number"==typeof e?Math.floor(e*Math.random()):e instanceof Array?e[Math.floor(e.length*Math.random())]:Math.random()}Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=t.array=t.rnd=void 0,t.rnd=s,t.array=function(e,t,s){const n=[];for(let r=0;r<t;++r){const t=[];for(let n=0;n<e;++n)t.push(s(r,n));n.push(t)}return n},t.shuffle=function(e){for(let t=e.length-1;t>0;--t){const n=s(t+1);[e[t],e[n]]=[e[n],e[t]]}}},695:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.newVector=t.Vector=t.AABB=void 0,t.AABB=class{constructor(e,t,s,n){this.x=e,this.y=t,this.w=s,this.h=n}contains(e){const{x:t,y:s,w:n,h:r}=this;return e.x>=t&&e.y>=s&&e.x<t+n&&e.y<s+r}intersects(e){const{x:t,y:s,w:n,h:r}=this;return!(t+n<e.x||s+r<e.y||e.x+e.w<t||e.y+e.h<s)}};class s{constructor(e,t){this.x=e,this.y=t}get mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(e){return new s(this.x+e.x,this.y+e.y)}times(e){return new s(e*this.x,e*this.y)}distance(e){const t=e.x-this.x,s=e.y-this.y;return Math.sqrt(t*t+s*s)}}t.Vector=s,t.newVector=(e,t)=>new s(Math.cos(e)*t,Math.sin(e)*t)},419:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;const n=s(996);t.Renderer=class{constructor(){this.ctx=(0,n.fullscreenCanvas)(!1,!0)}draw(e,t,s,n,r,o){const{ctx:i,width:a,height:c}=this;i.save(),i.clearRect(0,0,a,c);const l=.5+(0|Math.min(c/50,a/50)),h=a-2*l,d=c-2*l;i.scale(h/r.w,-d/r.h),i.translate(l-r.x,-l-r.y-r.h),i.beginPath(),i.rect(r.x,r.y,r.w,r.h),i.clip(),i.strokeStyle="#630";let m=r.w/24|0,u=r.h/24|0;for(let e=0;e<12;++e)i.strokeRect(r.x+m*e*2,r.y,m,r.h),i.strokeRect(r.x,r.y+u*e*2,r.w,u);i.fillStyle="gold",i.strokeStyle="gold";for(let t of e)i.fillCircle(t.x,t.y,10*(1+.2*Math.sin(1*o.frame/10))),i.strokeCircle(t.x,t.y,50*(1+.2*Math.sin(1*o.frame/9)));i.strokeStyle="white",i.lineWidth=8;for(let e of s)e.isDead||(i.beginPath(),i.moveTo(e.pos.x,e.pos.y),i.lineTo(e.pos.x-70*e.burnVector.x,e.pos.y-70*e.burnVector.y),i.stroke());i.fillStyle="#E23636";for(let e of s)e.isDead||(i.save(),i.translate(e.pos.x,e.pos.y),i.rotate(Math.atan2(e.vector.y,e.vector.x)-Math.PI/2),i.scale(2,2),i.beginPath(),i.moveTo(0,10),i.lineTo(10/3,0),i.lineTo(-10/3,0),i.closePath(),i.fill(),i.restore());i.fillStyle="white";for(let e of n)i.fillCircle(e.pos.x,e.pos.y,50*(f=e.age/e.lifespan,1-Math.pow(1-f,5)));var f;i.lineWidth=2,i.fillStyle="#000",i.strokeStyle="#fc0",i.strokeRect(r.x,r.y,r.w,r.h);for(let e of t)i.fillRect(e.x,e.y,e.w,e.h),i.strokeRect(e.x,e.y,e.w,e.h);i.translate(r.x+10,r.h-10),i.scale(1,-1);let x=0;for(let e=0;e<12;++e){let t=s[(e+(o.frame/10|0))%s.length],n=0;for(let e of t.commands){n+=e.leadTime;let t=Math.atan2(e.vector.y,e.vector.x);i.fillStyle=`hsl(${180*t/Math.PI}, 100%, 80%)`,i.fillRect(n/80,3*x,e.burnTime/80,2),n+=e.burnTime,n+=e.outTime}if(++x>12)break}x+=45,this.ctx.fillStyle="grey",this.ctx.fillText(o.first+"s",0,x),this.ctx.fillText(o.globalBest.toFixed(2)+"pts % "+(1/o.rate/1e3).toFixed(3)+"s/pt",0,x+20),this.ctx.restore()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}}},842:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Explosion=t.Command=t.Rocket=void 0;const n=s(663),r=s(695);t.Rocket=class{constructor(e,t,s,n){this.gravity=s,this.commands=n,this.commandIndex=0,this.timer=0,this.state="lead-in",this.burnVector=new r.Vector(0,0),this.vector=new r.Vector(0,0),this.bestScore=0,this.isDead=!1,this.pos=new r.Vector(e,t)}score(e){this.bestScore=Math.max(this.bestScore,e)}advance(e){let t=e,s=this.commands[this.commandIndex],n=new r.Vector(0,0),o=!0;for(;o;)switch(o=!1,this.state){case"lead-in":this.timer+t>s.leadTime?(t-=s.leadTime-this.timer,this.timer=0,this.state="burn",o=!0):this.timer+=t;break;case"burn":if(this.timer+t>s.burnTime){const e=s.burnTime-this.timer;n=n.add(s.vector.times(e/1e3)),t-=e,this.timer=0,this.state="lead-out",o=!0}else n=n.add(s.vector.times(t/1e3)),this.timer+=t;break;case"lead-out":this.timer+t>s.outTime?(t-=s.outTime-this.timer,this.timer=0,this.commandIndex=++this.commandIndex%this.commands.length,s=this.commands[this.commandIndex],this.state="lead-in",o=!0):this.timer+=t}this.burnVector=n,this.vector=this.vector.add(n).add(this.gravity.times(e)),this.pos=this.pos.add(this.vector)}},t.Command=class{constructor(e,t,s,n){this.leadTime=e,this.burnTime=t,this.vector=s,this.outTime=n}},t.Explosion=class{constructor(e){this.pos=e,this.age=0,this.lifespan=(0,n.rnd)(100,300)}advance(e){this.age+=e}get isAlive(){return this.age<this.lifespan}}},882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deg=t.tau=t.array=void 0,t.array=(e,t)=>{const s=new Array(e);for(let n=0;n<e;++n)s[n]=t(n);return s},t.tau=2*Math.PI,t.deg=Math.PI/180}},t={};function s(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}(()=>{const e=s(424),t=s(419),n=s(663),r=s(695),o=s(882),i=s(842),a=500;let c=0;function l(e,t){(0,n.rnd)()<.5&&([e,t]=[t,e]);let s=(0,n.rnd)(e.length),o=(0,n.rnd)(e.length),a=(0,n.rnd)(t.length),c=(0,n.rnd)(t.length);s>o&&([s,o]=[o,s]),a>c&&([a,c]=[c,a]);const l=e.slice(0,s).concat(t.slice(a,c)).concat(e.slice(o));if((0,n.rnd)()<.3){const e=(0,n.rnd)(["flip","drop","spawn"]),t=(0,n.rnd)(l.length);switch(e){case"flip":l[t]=h();break;case"drop":l.splice(t,1);break;case"spawn":l.splice(t,0,h());break;case"burn":l[t]=new i.Command(l[t].leadTime,l[t].burnTime*(0,n.rnd)(.9,1.1),l[t].vector,l[t].outTime);break;case"aim":let e=l[t].vector.mag*(0,n.rnd)(.05,.2),s=(0,r.newVector)((0,n.rnd)(360),e);l[t]=new i.Command(l[t].leadTime,l[t].burnTime,new r.Vector(l[t].vector.x+s.x,l[t].vector.y+s.y),l[t].outTime);break;case"force":let o=(0,n.rnd)(.9,1.1);l[t]=new i.Command(l[t].leadTime,l[t].burnTime,new r.Vector(l[t].vector.x*o,l[t].vector.y*o),l[t].outTime);break;case"out":l[t]=new i.Command(l[t].leadTime,l[t].burnTime,l[t].vector,l[t].outTime*(0,n.rnd)(.9,1.1))}}return l}function h(){return new i.Command(0,(0,n.rnd)(300,700),(0,r.newVector)((0,n.rnd)(180)*o.deg,(0,n.rnd)(20,30)),(0,n.rnd)(400))}new e.Loop(1e3/60,(function(){const e=new t.Renderer,{width:s,height:c}=e,l=new r.AABB(-s/2,0,s,c),d=(0,o.array)(a,(e=>new i.Rocket(0,100,new r.Vector(0,-.015),(0,o.array)((0,n.rnd)(10,30),h)))),m=[new r.AABB(-s/4,.4*c,s/5,c/20),new r.AABB(s/20,.4*c,s/5,c/20),new r.AABB(-s/2,.7*c,s/4,c/20),new r.AABB(s/4,.7*c,s/4,c/20)];return{renderer:e,rockets:d,area:l,explosions:[],goals:[new r.Vector(-s/3,.9*c),new r.Vector(s/3,.9*c)],obstacles:m,wins:0,first:0,best:0,bestCommands:0,avgCommands:0,avgCommandsCount:0,globalBest:0,lastGlobalImp:0,rate:0,frame:0,gen:0}}),(function(e,t){t.explosions=t.explosions.filter((t=>(t.advance(e),t.isAlive))),++t.frame;let s=0,o=0;for(let n of t.rockets){if(n.isDead)continue;n.advance(e);const r=t.goals.reduce(((e,t)=>Math.min(e,t.distance(n.pos))),1/0),a=r<50,l=(r/50+c/1e3/10)/(a?1:2);n.score(l),a&&(t.wins++,0==t.first&&(t.first=c/1e3)),t.best=Math.max(t.best,n.bestScore),t.globalBest<n.bestScore&&(t.globalBest>0&&(t.rate=(n.bestScore-t.globalBest)/(performance.now()-t.globalBest)),t.lastGlobalImp=performance.now(),t.globalBest=n.bestScore),t.best==n.bestScore&&(t.bestCommands=n.commands.length),a||!t.area.contains(n.pos)||t.obstacles.some((e=>e.contains(n.pos)))?(t.explosions.every((e=>e.pos.distance(n.pos)>30||e.age/e.lifespan>.2))&&t.explosions.push(new i.Explosion(n.pos)),n.isDead=!0):(o+=n.commands.length,++s)}if(s>0&&(t.avgCommands+=o,t.avgCommandsCount+=s),(c+=e)>1e4||0==s){c=0,++t.gen,t.best=t.wins=t.first=t.bestCommands=0;const e=t.rockets;for(e.sort(((e,t)=>t.bestScore-e.bestScore)),t.rockets=[];t.rockets.length<a;){let s=e[(0,n.rnd)()*(0,n.rnd)()*a|0],o=e[(0,n.rnd)()*(0,n.rnd)()*a|0];if(s==o)continue;const c=l(s.commands,o.commands);c.length>=10&&c.length<30&&t.rockets.push(new i.Rocket(0,100,new r.Vector(0,-.015),c))}}return t}),(function(e,t){t.renderer.draw(t.goals,t.obstacles,t.rockets,t.explosions,t.area,t)})).start()})()})();