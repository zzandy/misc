(()=>{"use strict";var t={996:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fullscreenCanvas=e.fullscreenCanvas3d=e.getCanvas=void 0,e.getCanvas=(t=!1)=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,t||(e.style.position="absolute",e.style.top="0",e.style.left="0"),e},e.fullscreenCanvas3d=(t=!1)=>{const s=(0,e.getCanvas)(t),n=s.getContext("webgl");if(null==n)throw new Error("failed to get 'webgl' context");return document.body.appendChild(s),n},e.fullscreenCanvas=function(t=!1,n=!1){const r=(0,e.getCanvas)(t),i=r.getContext("2d",{alpha:!n});if(null==i)throw new Error("failed to get '2d' context");return i.clear=function(){return i.clearRect(0,0,i.canvas.width,i.canvas.height),i},i.makePath=function(t){i.beginPath(),i.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)i.lineTo(t[e],t[e+1]);return i.closePath(),i},i.strokeCircle=function(t,e,s){return i.beginPath(),i.arc(t,e,s,0,2*Math.PI,!0),i.closePath(),i.stroke(),i},i.fillCircle=function(t,e,s){return i.beginPath(),i.arc(t,e,s,0,2*Math.PI,!0),i.closePath(),i.fill(),i},i.fillHex=function(t,e,n){i.beginPath(),i.save(),i.translate(t,e),i.moveTo(n/s,0);for(let t=0;t<5;++t)i.rotate(Math.PI/3),i.lineTo(n/s,0);return i.restore(),i.closePath(),i.fill(),i},document.body.style.overflow="hidden",document.body.appendChild(r),i};const s=Math.sqrt(3)/2},424:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Loop=void 0,e.Loop=class{constructor(t,e,s,n){this.fixedDelta=t,this.init=e,this.fixed=s,this.variable=n,this.isRunning=!1,this.fixedAccum=0}start(){if(this.isRunning)return;let t=this.init();this.isRunning=!0;let e=0;const s=n=>{const r=0==e,i=r?0:n-e;e=n,t=this.update(i,t,r),this.isRunning&&requestAnimationFrame(s)};requestAnimationFrame(s)}stop(){this.isRunning=!1}update(t,e,s=!1){let n=e;this.fixedAccum+=t;let r=!1;if(s)n=this.fixed(this.fixedDelta,n),r=!0;else for(;this.fixedAccum>this.fixedDelta;)this.fixedAccum-=this.fixedDelta,n=this.fixed(this.fixedDelta,n),r=!0;return r&&this.variable(t,n),n}}},663:(t,e)=>{function s(t,e){return"number"==typeof e&&"number"==typeof t?Math.floor(t+Math.random()*(e-t)):"number"==typeof t?Math.floor(t*Math.random()):t instanceof Array?t[Math.floor(t.length*Math.random())]:Math.random()}Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=e.array=e.rnd=void 0,e.rnd=s,e.array=function(t,e,s){const n=[];for(let r=0;r<e;++r){const e=[];for(let n=0;n<t;++n)e.push(s(r,n));n.push(e)}return n},e.shuffle=function(t){for(let e=t.length-1;e>0;--e){const n=s(e+1);[t[e],t[n]]=[t[n],t[e]]}}},695:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.newVector=e.Vector=e.AABB=void 0,e.AABB=class{constructor(t,e,s,n){this.x=t,this.y=e,this.w=s,this.h=n}contains(t){const{x:e,y:s,w:n,h:r}=this;return t.x>=e&&t.y>=s&&t.x<e+n&&t.y<s+r}intersects(t){const{x:e,y:s,w:n,h:r}=this;return!(e+n<t.x||s+r<t.y||t.x+t.w<e||t.y+t.h<s)}};class s{constructor(t,e){this.x=t,this.y=e}get mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return new s(this.x+t.x,this.y+t.y)}times(t){return new s(t*this.x,t*this.y)}distance(t){const e=t.x-this.x,s=t.y-this.y;return Math.sqrt(e*e+s*s)}}e.Vector=s,e.newVector=(t,e)=>new s(Math.cos(t)*e,Math.sin(t)*e)},419:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const n=s(996),r=s(882);e.Renderer=class{constructor(){this.ctx=(0,n.fullscreenCanvas)(!0)}draw(t,e,s,n,i){const{ctx:o,width:a,height:c}=this;o.save(),o.clearRect(0,0,a,c);const h=.5+(0|Math.min(c/50,a/50)),l=a-2*h,d=c-2*h;o.scale(l/i.w,-d/i.h),o.translate(h-i.x,-h-i.y-i.h),o.strokeStyle="#aaa",o.strokeRect(i.x,i.y,i.w,i.h);for(let t of e)o.strokeRect(t.x,t.y,t.w,t.h);o.fillStyle="gold";for(let e of t)o.fillCircle(e.x,e.y,10),o.strokeCircle(e.x,e.y,50);for(let t of s)t.isDead||(o.save(),o.translate(t.pos.x,t.pos.y),o.strokeCircle(0,0,10),o.beginPath(),o.moveTo(0,0),o.lineTo(20*Math.cos(r.tau*t.a),20*Math.sin(r.tau*t.a)),o.stroke(),o.scale(10,10),o.beginPath(),o.moveTo(0,0),o.lineTo(-8*t.burnVector.x,-8*t.burnVector.y),o.strokeStyle="red",o.stroke(),o.restore());o.fillStyle="white";for(let t of n)o.fillCircle(t.pos.x,t.pos.y,t.age/4);this.ctx.restore()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}}},842:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Explosion=e.Command=e.Rocket=void 0;const n=s(663),r=s(695);e.Rocket=class{constructor(t,e,s,n,i){this.gravity=s,this.commands=n,this.a=i,this.commandIndex=0,this.timer=0,this.state="lead-in",this.burnVector=new r.Vector(0,0),this.vector=new r.Vector(0,0),this.bestScore=0,this.isDead=!1,this.pos=new r.Vector(t,e)}score(t){this.bestScore=Math.max(this.bestScore,t)}advance(t){let e=t,s=this.commands[this.commandIndex],n=new r.Vector(0,0),i=!0;for(;i;)switch(i=!1,this.state){case"lead-in":this.timer+e>s.leadTime?(e-=s.leadTime-this.timer,this.timer=0,this.state="burn",i=!0):this.timer+=e;break;case"burn":if(this.timer+e>s.burnTime){const t=s.burnTime-this.timer;n=n.add(s.vector.times(t/1e3)),e-=t,this.timer=0,this.state="lead-out",i=!0}else n=n.add(s.vector.times(e/1e3)),this.timer+=e;break;case"lead-out":this.timer+e>s.outTime?(e-=s.outTime-this.timer,this.timer=0,this.commandIndex=++this.commandIndex%this.commands.length,s=this.commands[this.commandIndex],this.state="lead-in",i=!0):this.timer+=e}this.burnVector=n,this.vector=this.vector.add(n).add(this.gravity.times(t)),this.pos=this.pos.add(this.vector)}},e.Command=class{constructor(t,e,s,n){this.leadTime=t,this.burnTime=e,this.vector=s,this.outTime=n}},e.Explosion=class{constructor(t){this.pos=t,this.age=0,this.lifespan=(0,n.rnd)(100,600)}advance(t){this.age+=t}get isAlive(){return this.age<this.lifespan}}},882:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.deg=e.tau=e.array=void 0,e.array=(t,e)=>{const s=new Array(t);for(let n=0;n<t;++n)s[n]=e(n);return s},e.tau=2*Math.PI,e.deg=Math.PI/180}},e={};function s(n){var r=e[n];if(void 0!==r)return r.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,s),i.exports}(()=>{const t=s(424),e=s(419),n=s(663),r=s(695),i=s(882),o=s(842),a=500;let c=0;function h(t,e){(0,n.rnd)()<.5&&([t,e]=[e,t]);let s=(0,n.rnd)(t.length),r=(0,n.rnd)(t.length),i=(0,n.rnd)(e.length),o=(0,n.rnd)(e.length);s>r&&([s,r]=[r,s]),i>o&&([i,o]=[o,i]);const a=t.slice(0,s).concat(e.slice(i,o)).concat(t.slice(r));if((0,n.rnd)()<.3){const t=(0,n.rnd)(["flip","drop","spawn"]),e=(0,n.rnd)(a.length);switch(t){case"flip":a[e]=l();break;case"drop":a.splice(e,1);break;case"spawn":a.splice(e,0,l())}}return a}function l(){return new o.Command(0,(0,n.rnd)(300,700),(0,r.newVector)((0,n.rnd)(180)*i.deg,(0,n.rnd)(20,30)),(0,n.rnd)(400))}new t.Loop(1e3/60,(function(){const t=new e.Renderer,{width:s,height:c}=t,h=new r.AABB(-s/2,0,s,c),d=(0,i.array)(a,(t=>new o.Rocket(0,100,new r.Vector(0,-.015),(0,i.array)((0,n.rnd)(10,30),l),t/a))),u=[new r.AABB(-s/4,.4*c,s/2,c/20),new r.AABB(-s/2,.7*c,s/3,c/20),new r.AABB(s/6,.7*c,s/3,c/20)];return{renderer:t,rockets:d,area:h,explosions:[],goals:[new r.Vector(-s/3,.9*c),new r.Vector(s/3,.9*c)],obstacles:u,wins:0,first:0,best:0,bestCommands:0,avgCommands:0,avgCommandsCount:0}}),(function(t,e){e.explosions=e.explosions.filter((e=>(e.advance(t),e.isAlive)));let s=0,i=0;for(let n of e.rockets){if(n.isDead)continue;n.advance(t);const r=e.goals.reduce(((t,e)=>Math.min(t,e.distance(n.pos))),1/0),a=r<50,h=(r/50+c/1e3/7)/(a?1:2);n.score(h),a&&(e.wins++,0==e.first&&(e.first=c/1e3)),e.best=Math.max(e.best,n.bestScore),e.best==n.bestScore&&(e.bestCommands=n.commands.length),a||!e.area.contains(n.pos)||e.obstacles.some((t=>t.contains(n.pos)))?(e.explosions.every((t=>t.pos.distance(n.pos)>30||t.age/t.lifespan>.2))&&e.explosions.push(new o.Explosion(n.pos)),n.isDead=!0):(i+=n.commands.length,++s)}if(s>0&&(e.avgCommands+=i,e.avgCommandsCount+=s),(c+=t)>7e3||0==s){c=0,e.best=e.wins=e.first=e.bestCommands=0;const t=e.rockets;t.sort(((t,e)=>e.bestScore-t.bestScore)),e.rockets=[];let s=0;for(;e.rockets.length<a;){let i=t[(0,n.rnd)()*(0,n.rnd)()*a|0],c=t[(0,n.rnd)()*(0,n.rnd)()*a|0];if(i==c)continue;const l=h(i.commands,c.commands);l.length>=10&&l.length<30&&e.rockets.push(new o.Rocket(0,100,new r.Vector(0,-.015),l,++s/a))}}return e}),(function(t,e){e.renderer.draw(e.goals,e.obstacles,e.rockets,e.explosions,e.area)})).start()})()})();