!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=3)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fall=t.Burst=void 0;const n=s(1),r=Math.sqrt;t.Burst=class{constructor(){this.phase=-r(n.rnd(16)/90)}};t.Fall=class{constructor(e){this.dropHeight=e,this.phase=0}plus(e){return this.dropHeight+=e,this}}},function(e,t,s){"use strict";function n(e,t){return"number"==typeof t&&"number"==typeof e?Math.floor(e+Math.random()*(t-e)):"number"==typeof e?Math.floor(e*Math.random()):e instanceof Array?e[Math.floor(e.length*Math.random())]:Math.random()}Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=t.array=t.rnd=void 0,t.rnd=n,t.array=function(e,t,s){const n=[];for(let r=0;r<t;++r){const t=[];for(let n=0;n<e;++n)t.push(s(r,n));n.push(t)}return n},t.shuffle=function(e){for(let t=e.length-1;t>0;--t){const s=n(t+1);[e[t],e[s]]=[e[s],e[t]]}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newVector=t.Vector=t.AABB=void 0;t.AABB=class{constructor(e,t,s,n){this.x=e,this.y=t,this.w=s,this.h=n}contains(e){const{x:t,y:s,w:n,h:r}=this;return e.x>=t&&e.y>=s&&e.x<t+n&&e.y<s+r}intersects(e){const{x:t,y:s,w:n,h:r}=this;return!(t+n<e.x||s+r<e.y||e.x+e.w<t||e.y+e.h<s)}};class n{constructor(e,t){this.x=e,this.y=t}get mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(e){return new n(this.x+e.x,this.y+e.y)}to(e){return new n(e.x-this.x,e.y-this.y)}times(e){return new n(e*this.x,e*this.y)}distance(e){const t=e.x-this.x,s=e.y-this.y;return Math.sqrt(t*t+s*s)}}t.Vector=n,t.newVector=(e,t)=>new n(Math.cos(e)*t,Math.sin(e)*t)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(4),r=s(5),i=s(0),o=s(1),c=s(2),l=s(8),a=new r.ScreenManager(4);new n.Loop(1e3/60,(function(){const e=new l.HexStore(4,(e,t)=>({color:o.rnd(7),spring:new c.Vector(0,0),change:null})),t={size:4,numColors:7,cells:e};return window.addEventListener("keydown",e=>{"KeyR"==e.code&&(t.cells=new l.HexStore(4,(e,t)=>({color:o.rnd(7),spring:new c.Vector(0,0),change:null})))}),t}),(function(e,t){function s(e,t,s,n){return null!=t.change?[]:0==e.length?[t]:e[0].color==t.color?(e.push(t),3==e.length?e.forEach(e=>e.change=new i.Burst):e.length>3&&(t.change=new i.Burst),e):[t]}t.cells.reduceRows(()=>[],s),t.cells.reduceCols(()=>[],s),t.cells.reduceDiags(()=>[],s);return t.cells.each((s,n,r)=>{if(r.change instanceof i.Fall)r.change.phase+=e/200,r.change.phase>r.change.dropHeight&&(r.change=null);else if(r.change instanceof i.Burst)if(r.change.phase<1)r.change.phase+=e/120,r.change.phase>1&&(r.change.phase=1);else{let e=n,c=1,l=0,a=r;for(;e>=0;){if(++l,l>1e3)throw s+" "+n;let r=t.cells.get(s,e-1);if(void 0===r)a.change=new i.Fall(c),a.color=o.rnd(7),--e;else if(null==r.change)a.change=new i.Fall(c),a.color=r.color,a=r,--e;else if(r.change instanceof i.Fall)a.color=r.color,a.change=r.change.plus(1),c=a.change.dropHeight,a=r,--e;else{if(r.change instanceof i.Burst)break;++c}}}}),t}),(e,t)=>a.render(e,t)).start()},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loop=void 0;t.Loop=class{constructor(e,t,s,n){this.fixedDelta=e,this.init=t,this.fixed=s,this.variable=n,this.isRunning=!1,this.fixedAccum=0}start(){if(this.isRunning)return;let e=this.init();this.isRunning=!0;let t=0;const s=n=>{const r=0==t,i=r?0:n-t;t=n,e=this.update(i,e,r),this.isRunning&&requestAnimationFrame(s)};requestAnimationFrame(s)}stop(){this.isRunning=!1}update(e,t,s=!1){let n=t;this.fixedAccum+=e;let r=!1;if(s)n=this.fixed(this.fixedDelta,n),r=!0;else for(;this.fixedAccum>this.fixedDelta;)this.fixedAccum-=this.fixedDelta,n=this.fixed(this.fixedDelta,n),r=!0;return r&&this.variable(e,n),n}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenManager=t.HexScaler=void 0;const n=s(6),r=s(0),i=s(2),o=s(7),c=["#fed203","#d6050d","#1337b2","#079ecd","#f76f03","#8e0c70","#cbcbcb"],l=Math.sqrt(3)/2;class a{constructor(e,t){this.size=e;const{x:s,y:n,w:r,h:o}=t,c=t.h/(2*e-1),a=t.w/((2*e-2)*l+1);this.r=Math.min(c,a)/2;const h=2*this.r*((2*e-2)*l+1),u=2*this.r*(2*e-1);this.area=new i.AABB(s+(r-h)/2,n+(o-u)/2,h,u)}screenToStore(e){if(!this.area.contains(e))return null;const t=(e.x-this.area.x-this.r)/2/l/this.r+.333;let s=Math.floor(t),n=(e.y-this.area.y+(s-this.size)*this.r)/2/this.r+.5,r=Math.floor(n);const i=t-s,o=n-r;let c=0,a=0;return i>.666&&(o<.5&&o<3*i/2-1?c=1:o>.5&&o>-3*i/2+2&&(c=1,a=1)),[s+c,r+a]}storeToScreen(e,t){return new i.Vector(this.area.x+l*e*this.r*2+this.r,+this.area.y+t*this.r*2-(e-this.size)*this.r)}}t.HexScaler=a;function h(e){return e*e*e*(e*(6*e-15)+10)}t.ScreenManager=class{constructor(e){this.ctx=n.fullscreenCanvas(),this.pos=new i.Vector(0,0),this.active=null;let t=this.ctx.canvas,{width:s,height:r}=t;this.scaler=new a(e,new i.AABB(10,10,s-20,r-20));const c=this.scaler.r,h=o.tau/12,u=new Path2D;[this.scaler.storeToScreen(0,0).add(new i.Vector(-c,0)),this.scaler.storeToScreen(0,0),this.scaler.storeToScreen(e-1,0).add(new i.Vector(-c/2,-c*l)),this.scaler.storeToScreen(e-1,0),this.scaler.storeToScreen(2*e-2,e-1).add(new i.Vector(c/2,-c*l)),this.scaler.storeToScreen(2*e-2,e-1),this.scaler.storeToScreen(2*e-2,2*e-2).add(new i.Vector(c,0)),this.scaler.storeToScreen(2*e-2,2*e-2),this.scaler.storeToScreen(e-1,2*e-2).add(new i.Vector(c/2,c*l)),this.scaler.storeToScreen(e-1,2*e-2),this.scaler.storeToScreen(0,e-1).add(new i.Vector(-c/2,c*l)),this.scaler.storeToScreen(0,e-1)].forEach((e,t)=>{if(t%2==0)0==t?u.moveTo(e.x,e.y):u.lineTo(e.x,e.y);else{u.arc(e.x,e.y,c,h*(t+5),h*(t+7))}}),this.clipPath=u,t.addEventListener("mousemove",e=>this.onMove(e)),t.addEventListener("mousedown",e=>this.onDown(e)),t.addEventListener("mouseup",e=>this.onUp(e))}onMove(e){this.pos=new i.Vector(e.clientX,e.clientY),this.active=this.scaler.screenToStore(this.pos)}onDown(e){}onUp(e){}render(e,t){const s=this.ctx,{width:n,height:i}=s.canvas,o=this.scaler.r,l=.9*o;s.fillStyle="#161610",s.fillRect(0,0,n,i),s.save();s.clip(this.clipPath),t.cells.each((e,t,n)=>{const i=n.color;s.save(),s.strokeStyle="white",s.fillStyle=c[i];const a=this.scaler.storeToScreen(e,t);if(s.translate(a.x,a.y),n.change instanceof r.Burst){const e=h(Math.min(1,1-n.change.phase));s.scale(e,e)}else if(n.change instanceof r.Fall){const e=n.change,t=e.dropHeight*h((e.dropHeight-e.phase)/e.dropHeight);s.translate(0,-t*o*2)}null!=this.active&&this.active[0]==e&&this.active[1]==t&&s.strokeCircle(0,0,l),s.fillCircle(0,0,l),s.fillStyle="black";const u=e+" "+t;s.fillText(u,0-s.measureText(u).width/2,4),s.restore()}),s.restore()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fullscreenCanvas=t.fullscreenCanvas3d=t.getCanvas=void 0,t.getCanvas=(e=!1)=>{const t=document.createElement("canvas");return t.width=window.innerWidth,t.height=window.innerHeight,e||(t.style.position="absolute",t.style.top="0",t.style.left="0"),t},t.fullscreenCanvas3d=(e=!1)=>{const s=t.getCanvas(e),n=s.getContext("webgl");if(null==n)throw new Error("failed to get 'webgl' context");return document.body.appendChild(s),n},t.fullscreenCanvas=function(e=!1,s=!1){const n=t.getCanvas(e),r=n.getContext("2d",{alpha:!s});if(null==r)throw new Error("failed to get '2d' context");return r.clear=function(){return r.clearRect(0,0,r.canvas.width,r.canvas.height),r},r.makePath=function(e){r.beginPath(),r.moveTo(e[0],e[1]);for(var t=2;t<e.length;t+=2)r.lineTo(e[t],e[t+1]);return r.closePath(),r},r.strokeCircle=function(e,t,s){return r.beginPath(),r.arc(e,t,s,0,2*Math.PI,!0),r.closePath(),r.stroke(),r},r.fillCircle=function(e,t,s){return r.beginPath(),r.arc(e,t,s,0,2*Math.PI,!0),r.closePath(),r.fill(),r},document.body.style.overflow="hidden",document.body.appendChild(n),r}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deg=t.tau=t.array=void 0,t.array=(e,t)=>{const s=new Array(e);for(let n=0;n<e;++n)s[n]=t(n);return s},t.tau=2*Math.PI,t.deg=Math.PI/180},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HexStore=void 0;t.HexStore=class{constructor(e,t){this.size=e,this.w=2*e-1,this.cells=[];for(let s=0;s<this.w;++s){let n=new Array(this.w);for(let r=0;r<this.w;++r)r-s>=e||s-r>=e||(n[r]=t(s,r));this.cells.push(n)}}get(e,t){if(t-e>=this.size||e-t>=this.size)return;return void 0===this.cells[e]?void 0:this.cells[e][t]}each(e){for(let t=0;t<this.cells.length;++t)for(let s=0;s<this.cells[t].length;++s)void 0!==this.cells[t][s]&&e(t,s,this.cells[t][s])}reduceCols(e,t){for(let s=0;s<this.cells.length;++s){let n=e();for(let e=0;e<this.cells[s].length;++e)void 0!==this.cells[s][e]&&(n=t(n,this.cells[s][e],s,e))}}reduceRows(e,t){for(let s=0;s<this.w;++s){let n=e();for(let e=0;e<this.cells.length;++e)void 0!==this.cells[e][s]&&(n=t(n,this.cells[e][s],e,s))}}reduceDiags(e,t){let s=e();for(let e=0;e<this.w;++e)null!=this.cells[e][e]&&(s=t(s,this.cells[e][e],e,e));for(let i=1;i<this.size;++i){s=e();let o=e();for(var n=0,r=i;n<this.w;++n,++r)r<this.cells.length&&void 0!==this.cells[r][n]&&(s=t(s,this.cells[r][n],r,n)),void 0!==this.cells[n][r]&&(o=t(o,this.cells[n][r],r,i))}}}}]);